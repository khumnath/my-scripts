<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adhika & Kshaya Masa Finder</title>
    <link href="https://unpkg.com/tailwindcss@1.9.6/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-white">Adhika & Kshaya Masa Finder</h1>
            <p class="text-gray-400 mt-2">Special lunar months calculated from 1800 AD to 3000 AD.</p>
        </header>

        <main class="flex flex-col lg:flex-row gap-8">
            <!-- Adhika Masa Section -->
            <div id="adhika-container" class="bg-gray-800 p-6 rounded-lg shadow-lg lg:w-3/4">
                <h2 class="text-xl font-semibold text-white mb-4">Adhika Months (अधिक मास)</h2>
                <div id="adhika-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-2 text-sm">
                    <!-- Adhika month items will be inserted here -->
                </div>
            </div>

            <!-- Kshaya Masa Table -->
            <div id="kshaya-container" class="bg-gray-800 p-6 rounded-lg shadow-lg lg:w-1/4">
                <h2 class="text-xl font-semibold text-white mb-4">Kshaya Months (क्षय मास)</h2>
                 <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead class="bg-gray-700/50">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">#</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Month & Year (B.S.)</th>
                            </tr>
                        </thead>
                        <tbody id="kshaya-table-body" class="bg-gray-800 divide-y divide-gray-700">
                             <!-- Rows will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>Calculations based on the Surya Siddhanta astronomical model.</p>
        </footer>
    </div>

    <script src="calc.js"></script>

    <!--
      STEP 2: Run the application logic that uses the library.
    -->
    <script>
        function findNextAdhikaKshaya(startDate, yearsToSearch) {
            var results = {
                adhika: [],
                kshaya: []
            };

            var currentDate = new Date(startDate.getTime());
            var endDate = new Date(startDate.getFullYear() + yearsToSearch, startDate.getMonth(), startDate.getDate());
            var lastMonthChecked = "";
            const GREGORIAN_MONTHS = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

            while (currentDate < endDate) {
                var ahar = Panchanga.toJulianDay(currentDate.getUTCFullYear(), currentDate.getUTCMonth(), currentDate.getUTCDate()) - Panchanga.KaliEpoch;
                var monthInfo = Panchanga.calculateAdhikaMasa(ahar);

                if (monthInfo !== "छैन") {
                    var bsDate = Panchanga.toBikramSambat(currentDate);
                    var monthYearString = monthInfo + " (" + bsDate.year + ")";
                    
                    if (lastMonthChecked !== monthYearString) {
                        var adMonth1 = GREGORIAN_MONTHS[currentDate.getUTCMonth()];
                        var nextMonthDate = new Date(currentDate);
                        nextMonthDate.setUTCDate(nextMonthDate.getUTCDate() + 29);
                        var adMonth2 = GREGORIAN_MONTHS[nextMonthDate.getUTCMonth()];
                        var adString = `(${adMonth1}/${adMonth2} ${currentDate.getUTCFullYear()})`;

                        var resultObj = {
                            bsString: monthYearString,
                            adString: adString,
                            bsYear: bsDate.year,
                        };

                        if (monthInfo.startsWith("अधिक")) {
                            results.adhika.push(resultObj);
                        } else if (monthInfo.startsWith("क्षय")) {
                            results.kshaya.push(resultObj);
                        }
                        lastMonthChecked = monthYearString;
                    }
                }

                currentDate.setUTCDate(currentDate.getUTCDate() + 29);
            }

            // Sort the results by Bikram Sambat year
            results.adhika.sort((a, b) => a.bsYear - b.bsYear);
            results.kshaya.sort((a, b) => a.bsYear - b.bsYear);

            return results;
        }

        function populateAdhikaGrid(gridId, data) {
            const gridContainer = document.getElementById(gridId);
            if (!data || data.length === 0) {
                gridContainer.textContent = "None found in the search period.";
                return;
            }
            data.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = "py-2 border-b border-gray-700/50";
                
                const numberSpan = document.createElement('span');
                numberSpan.textContent = `${index + 1}. `;
                numberSpan.className = "text-gray-500 mr-1";

                const bsSpan = document.createElement('span');
                bsSpan.textContent = item.bsString;
                 if (item.bsYear >= 1900 && item.bsYear <= 2200) {
                    bsSpan.className = "text-green-400";
                } else {
                    bsSpan.className = "text-gray-300";
                }

                const adSpan = document.createElement('span');
                adSpan.textContent = ` ${item.adString}`;
                adSpan.className = "text-gray-500";

                div.appendChild(numberSpan);
                div.appendChild(bsSpan);
                div.appendChild(adSpan);
                gridContainer.appendChild(div);
            });
        }

        function populateKshayaTable(tableBodyId, data) {
            const tableBody = document.getElementById(tableBodyId);
            if (!data || data.length === 0) {
                const row = tableBody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 2;
                cell.textContent = "None found in the search period.";
                cell.className = "px-4 py-4 whitespace-nowrap text-sm text-gray-400 text-center";
                return;
            }
            data.forEach((item, index) => {
                const row = tableBody.insertRow();
                
                const cellNum = row.insertCell();
                cellNum.textContent = `${index + 1}.`;
                cellNum.className = "px-4 py-4 whitespace-nowrap text-sm text-gray-500";

                const cellData = row.insertCell();
                cellData.className = "px-4 py-4 whitespace-nowrap text-sm";
                
                const bsSpan = document.createElement('span');
                bsSpan.textContent = item.bsString;
                 if (item.isCentury) {
                    bsSpan.className = "text-green-400 font-bold block";
                } else if (item.bsYear >= 1900 && item.bsYear <= 2200) {
                    bsSpan.className = "text-green-400 block";
                } else {
                    bsSpan.className = "text-gray-300 block";
                }
                
                const adSpan = document.createElement('span');
                adSpan.textContent = item.adString;
                adSpan.className = "text-gray-500 block";

                cellData.appendChild(bsSpan);
                cellData.appendChild(adSpan);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            var startDate = new Date('1800-01-01T00:00:00Z');
            var searchYears = 1200; // 3000 - 1800
            var results = findNextAdhikaKshaya(startDate, searchYears);

            populateAdhikaGrid('adhika-grid', results.adhika);
            populateKshayaTable('kshaya-table-body', results.kshaya);
        });
    </script>

</body>
</html>
